---
title: "Taking a look into voting trends and effects"
subtitle: "INFO 526 - Spring 2024 - Project 1"
author: "The Power of Voters: Christian Ortmann, Sachin Patil, Abhishek Kumar, Tejas Bhawari, Monica Kommareddy, Nick Ferrante"
title-slide-attributes:
  data-background-image: images/USHouse1.jpeg
  data-background-size: stretch
  data-background-opacity: "0.5"
  data-slide-number: none
format:
  revealjs:
    transition: convex
    theme:  ['data/customtheming.scss']
    auto-animate-duration: 1.5
  
editor: visual
execute:
  echo: false
  warning: false
  message: false
editor_options: 
  chunk_output_type: console
---

```{r}
#| label: load-packages
#| include: false


# Load packages here
if (!require("pacman")) 
  install.packages("pacman")

options(timeout = 1200)

pacman::p_load(tidyverse, #Add new packages as necessary
               here,
               devtools,
               dlookr,
               dplyr,
               usmap,
               sf,
               ggrepel,
               scales,
               usmapdata, 
               grid,
               ggpubr
               )
remotes::install_github("ropensci/USAboundaries")
remotes::install_github("ropensci/USAboundariesData")


```

```{r}
#| label: setup
#| include: false

# Plot theme
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 14))

# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618, 
  fig.align = "center"
  )
```

```{r}
#| label: load-data
#| include: false
# Load data here
elec <- readr::read_csv('data/house_population_merged.csv')
describe(elec)
elec16to20 <- elec |>
  filter(between(year,2016,2020))

```

# US House Election Dataset

## Understanding the Dataset
-   Data sourced from MIT Election Data and Science Lab

::: {.fragment .fade-in}
-   Contains observations from elections in the House of Representatives over a span of 47 years starting in 1976 all the way up to 2022 and encompasses a total of 32,452 recorded events. Each event is represented with 20 attributes.
:::

::: {.fragment .fade-in}
-   For our analysis some of the most important variables will be:

    ::: columns
    ::: {.column width="33%"}
    **`year`**
    :::

    ::: {.column width="33%"}
    **`party`**
    :::

    ::: {.column width="34%"}
    **`state_po`**
    :::

    ::: {.column width="33%"}
    **`population`**
    :::
    
    ::: {.column width="33%"}
    **`totalvotes`**
    :::
    
    ::: {.column width="34%"}
    **`district`**
    :::
    :::
:::

## Question 1 {auto-animate=true}

::: {style="margin-top: 0px;"}
Election Results
:::
How did US voting trends change election results throughout the 2016-2020 presidential term?

::: {.fragment .fade-in}
### Analysis
To answer this question we will look at which party won in each state for the years 2016, 2018, and 2020 to identify patterns and significant changes that occurred in the election results.
:::

## {auto-animate=true}

::: {style="margin-top: -80px; font-size: 1.5em; font-weight: bold;"}
Election Results
:::
```{r}
#| label: Data Wrangling


for (date in c(2016, #aggregate state mode of party to determine which party has the 
               2018, #majority
               2020)) {
  result <- elec16to20 |>
    filter(year == date) |>
    group_by(state) |>
    summarize(winnerByHouseMajority = names(which.max(table(party))))
  assign(paste0('partyMaj', 
                date), 
         result)
}
  
for(date in c(2016,2018,2020)) { #for each state determine which party got the most votes
  result <- elec16to20 |>
    filter(year == date) |>
    group_by(state) |>
    summarize(winnerByTotalVotes = party[which.max(candidatevotes)], 
              partyVotes = sum(candidatevotes)) |>
    mutate(fips = fips(state)) #necessary for plotting on US map only on this plot because we will merge
  assign(paste0('genMaj',
                date), 
         result)
}

data2016 <- merge(genMaj2016,partyMaj2016) |>
  merge(centroid_labels(regions = c('states')), by = "fips") #adds in data for centroid of each state for labeling
data2018 <- merge(genMaj2018, partyMaj2018) |> 
  merge(centroid_labels(regions = c('states')), by = "fips")
data2020 <- merge(genMaj2020, partyMaj2020) |>
  merge(centroid_labels(regions = c('states')), by = "fips")
```

::: panel-tabset
## 2016
```{r  fig.width = 14, fig.height = 34 }
#| label: Data Visualization
#general plot just to get used to the function. We can add layers like a ggplot object
#For Question 1 we want three maps of the US where each state is colored based on the winning party, then also a number for each state corresponding to the party that had the most votes


 us2016 <- plot_usmap(data = data2016, 
           values = "winnerByHouseMajority", 
           labels = FALSE) + 
  scale_fill_manual(name = 'Winner by House Majority', 
                    values = c("REPUBLICAN" = 'red' , "DEMOCRAT" = 'blue'))+ 
  geom_label_repel(data = data2016,
                   aes(label = abbr,
                       geometry = geom,
                       color = winnerByTotalVotes),
                   stat = 'sf_coordinates',
                   size = 5,
                   force = 0.01, 
                   min.segment.length = 0) +
  scale_color_manual(name = 'Winner by Total Votes', values = c("REPUBLICAN"= "red", "DEMOCRAT"="blue")) +     guides(color = guide_legend(title = "Winner by Total Votes")) + 
  labs(
    title = 'House Majority vs Popular Vote Majority',
    subtitle = "By State in 2016",
    caption = "Teal & Harmon | Tidy Tuesday 2023"
  ) + 
  theme(
    plot.title = element_text(size = 25, hjust = 0.5, vjust = -10),
    plot.subtitle = element_text(size = 24, hjust = 0.5, vjust = -10),
    plot.caption = element_text(size = 20, hjust = 0.5),
    legend.text = element_text(size = 12, hjust = 0),
    legend.title = element_text(size = 16, hjust= 0),
    legend.position = c(0.6,0.03)
  )

us2016
```

## 2018
```{r fig.width = 14, fig.height = 34 }
us2018 <- plot_usmap(data = data2018,
           values = "winnerByHouseMajority",
           labels = FALSE) +
  scale_fill_manual(name = 'Winner by House Majority',
                    values = c("REPUBLICAN" = 'red' , "DEMOCRAT" = 'blue'))+
  geom_label_repel(data = data2016,
                   aes(label = abbr,
                       geometry = geom,
                       color = winnerByTotalVotes),
                   stat = 'sf_coordinates',
                   size = 5,
                   force = 0.01,
                   min.segment.length = 0) +
  scale_color_manual(name = 'Winner by Total Votes', values = c("REPUBLICAN"= "red", "DEMOCRAT"="blue")) +     guides(color = guide_legend(title = "Winner by Total Votes")) +
  labs(
    title = 'House Majority vs Popular Vote Majority',
    subtitle = "By State in 2018",
    caption = "Teal & Harmon | Tidy Tuesday 2023"
  ) +
  theme(
    plot.title = element_text(size = 25, hjust = 0.5, vjust = -10),
    plot.subtitle = element_text(size = 24, hjust = 0.5, vjust = -10),
    plot.caption = element_text(size = 20, hjust = 0.5),
    legend.text = element_text(size = 12, hjust = 0),
    legend.title = element_text(size = 16, hjust= 0),
    legend.position = c(0.6,0.03)
  )

us2018
```


## 2020
```{r fig.width = 14, fig.height = 34 }
us2020 <- plot_usmap(data = data2020,
           values = "winnerByHouseMajority",
           labels = FALSE) +
  scale_fill_manual(name = 'Winner by House Majority',
                    values = c("REPUBLICAN" = 'red' , "DEMOCRAT" = 'blue'))+
  geom_label_repel(data = data2016,
                   aes(label = abbr,
                       geometry = geom,
                       color = winnerByTotalVotes),
                   stat = 'sf_coordinates',
                   size = 5,
                   force = 0.01,
                   min.segment.length = 0,
                   force_pull = 0.5) +
  scale_color_manual(name = 'Winner by Total Votes', values = c("REPUBLICAN"= "red", "DEMOCRAT"="blue")) +     guides(color = guide_legend(title = "Winner by Total Votes")) +
  labs(
    title = 'House Majority vs Popular Vote Majority',
    subtitle = "By State in 2020",
    caption = "Teal & Harmon | Tidy Tuesday 2023"
  ) +
  theme(
    plot.title = element_text(size = 25, hjust = 0.5, vjust = -10),
    plot.subtitle = element_text(size = 24, hjust = 0.5, vjust = -10),
    plot.caption = element_text(size = 20, hjust = 0.5),
    legend.text = element_text(size = 12, hjust = 0),
    legend.title = element_text(size = 16, hjust= 0),
    legend.position = c(0.6,0.03)
  )

us2020
```


:::

## Insight
-   The sentiment of the general population is often overlooked by the electoral system
-   The sentiment of people during a single presidency will change significantly
-   Evident trends can be seen such as supporting the opposite party of the current president in midterm elections

## Question 2
How is the type of voting influenced by population and how does that influence who loses?

::: {.fragment .fade-in}
### Analysis
:::

## Arizona Distruct Results

```{r}
#| label: Arizona Congressional District Maps

elec12to22 <- elec |>
  filter(between(year,2012,2022))

ariz <- elec12to22 |>
  filter(state == "ARIZONA",
         !is.na(party))

for(date in c(2012, 2014, 2016, 2018, 2020,2022)){
  result2 <- ariz |>
    filter(year == date) |>
    group_by(district) |>
    summarise(winParty = party[which.max(candidatevotes)],
              partyVotes = sum(candidatevotes))
  assign(paste0('distWin', date), result2)
}
```

::: panel-tabset
## 2012
```{r}

# 2012 District Map
cd_az12 <- USAboundaries::us_congressional(resolution = "high", states = c("Arizona"))
cd_az12$party <- c("DEMOCRAT", "DEMOCRAT", "DEMOCRAT", "DEMOCRAT", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "DEMOCRAT")

cd_az12 |>
  ggplot() + 
  geom_sf(aes(fill = party)) +
  scale_fill_manual(name = "Party", values = c("blue", "red")) +
  labs(title = "Arizona Congressional Districts 2012") +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        panel.background = element_blank())


# 2014 District Map
# cd_az14 <- USAboundaries::us_congressional(resolution = "high", states = c("Arizona"))
# cd_az14$party <- c("REPUBLICAN", "DEMOCRAT", "DEMOCRAT", "DEMOCRAT", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "DEMOCRAT")
# 
# 
# cd_az14 |>
#   ggplot() + 
#   geom_sf(aes(fill = party)) +
#   scale_fill_manual(name = "Party", values = c("blue", "red")) +
#   labs(title = "Arizona Congressional Districts 2014") +
#   theme(legend.position = "bottom",
#         axis.text = element_blank(),
#         axis.ticks = element_blank(),
#         panel.grid = element_blank(),
#         panel.background = element_blank())
```


## 2016
```{r}

# 2016 District Map
cd_az16 <- USAboundaries::us_congressional(resolution = "high", states = c("Arizona"))
cd_az16$party <- c("REPUBLICAN", "DEMOCRAT", "DEMOCRAT", "DEMOCRAT", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "DEMOCRAT")

cd_az16 |>
  ggplot() + 
  geom_sf(aes(fill = party)) +
  scale_fill_manual(name = "Party", values = c("blue", "red")) +
  labs(title = "Arizona Congressional Districts 2016") +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        panel.background = element_blank())


# 2018 District Map
# cd_az18 <- USAboundaries::us_congressional(resolution = "high", states = c("Arizona"))
# cd_az18$party <- c("DEMOCRAT", "DEMOCRAT", "DEMOCRAT", "DEMOCRAT", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "DEMOCRAT")
# 
# 
# cd_az18 |>
#   ggplot() + 
#   geom_sf(aes(fill = party)) +
#   scale_fill_manual(name = "Party", values = c("blue", "red")) +
#   labs(title = "Arizona Congressional Districts 2018") +
#   theme(legend.position = "bottom",
#         axis.text = element_blank(),
#         axis.ticks = element_blank(),
#         panel.grid = element_blank(),
#         panel.background = element_blank())


# 2020 District Map
# cd_az20 <- USAboundaries::us_congressional(resolution = "high", states = c("Arizona"))
# cd_az20$party <- c("DEMOCRAT", "DEMOCRAT", "DEMOCRAT", "DEMOCRAT", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "DEMOCRAT")
# 
# 
# cd_az20 |>
#   ggplot() + 
#   geom_sf(aes(fill = party)) +
#   scale_fill_manual(name = "Party", values = c("blue", "red")) +
#   labs(title = "Arizona Congressional Districts 2020") +
#   theme(legend.position = "bottom",
#         axis.text = element_blank(),
#         axis.ticks = element_blank(),
#         panel.grid = element_blank(),
#         panel.background = element_blank())
```


## 2022
```{r}

# 2022 District Map
cd_az22 <- USAboundaries::us_congressional(resolution = "high", states = c("Arizona"))
cd_az22$party <- c("REPUBLICAN", "DEMOCRAT", "REPUBLICAN", "REPUBLICAN", "REPUBLICAN", "DEMOCRAT", "REPUBLICAN", "REPUBLICAN", "DEMOCRAT")

cd_az22 |>
  ggplot() + 
  geom_sf(aes(fill = party)) +
  scale_fill_manual(name = "Party", values = c("blue", "red")) +
  labs(title = "Arizona Congressional Districts 2022") +
  theme(axis.text = element_blank(),
        axis.ticks = element_blank(),
        panel.grid = element_blank(),
        panel.background = element_blank())



# cd_az |>
#   ggplot() + 
#   geom_sf(data = distWin2016, aes(geometry = , fill = winParty)) +
#   scale_fill_manual(name = "Party", 
#                     values = c("blue", "red")) +
#   labs(title = "Arizona Congressional Districts 2016") +
#   theme(legend.position = "bottom",
#         axis.text = element_blank(),
#         axis.ticks = element_blank(),
#         panel.background = element_blank())








```

:::

## Conclusion